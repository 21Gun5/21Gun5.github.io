<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.8.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"21guns.top","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="[toc] 宝马汽车实验安全评估-总结报告1. 介绍 近年来，越来越多的BMW汽车配备了新一代的“互联网连接”信息娱乐系统（如HU_NBT/HU_ENTRYNAV），也称为主机单元和远程通信控制单元（如TCB）。虽然这些组件明显提高了用户体验的便利性和性能，但它们也带来了新的被攻击机会。  在我们的工作中，我们系统地对多辆BMW汽车的Head Unit、TCU和中央网关模块的软硬件进行了深入和全面">
<meta name="keywords" content="IOV安全">
<meta property="og:type" content="article">
<meta property="og:title" content="宝马汽车实验安全评估-总结报告">
<meta property="og:url" content="http://21guns.top/2021/12/02/iov/宝马汽车实验安全评估-总结报告/index.html">
<meta property="og:site_name" content="have a nice day">
<meta property="og:description" content="[toc] 宝马汽车实验安全评估-总结报告1. 介绍 近年来，越来越多的BMW汽车配备了新一代的“互联网连接”信息娱乐系统（如HU_NBT/HU_ENTRYNAV），也称为主机单元和远程通信控制单元（如TCB）。虽然这些组件明显提高了用户体验的便利性和性能，但它们也带来了新的被攻击机会。  在我们的工作中，我们系统地对多辆BMW汽车的Head Unit、TCU和中央网关模块的软硬件进行了深入和全面">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081654.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081705.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081703.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81655.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81705.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081659.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081704.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081657.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081658.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81658.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081701.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081700.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081702.jpg">
<meta property="og:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81701.jpg">
<meta property="og:updated_time" content="2022-03-05T13:04:10.089Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="宝马汽车实验安全评估-总结报告">
<meta name="twitter:description" content="[toc] 宝马汽车实验安全评估-总结报告1. 介绍 近年来，越来越多的BMW汽车配备了新一代的“互联网连接”信息娱乐系统（如HU_NBT/HU_ENTRYNAV），也称为主机单元和远程通信控制单元（如TCB）。虽然这些组件明显提高了用户体验的便利性和性能，但它们也带来了新的被攻击机会。  在我们的工作中，我们系统地对多辆BMW汽车的Head Unit、TCU和中央网关模块的软硬件进行了深入和全面">
<meta name="twitter:image" content="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081654.jpg">

<link rel="canonical" href="http://21guns.top/2021/12/02/iov/宝马汽车实验安全评估-总结报告/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>宝马汽车实验安全评估-总结报告 | have a nice day</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">have a nice day</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://21guns.top/2021/12/02/iov/宝马汽车实验安全评估-总结报告/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="21Guns">
      <meta itemprop="description" content>
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="have a nice day">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          宝马汽车实验安全评估-总结报告
        </h1>

        <div class="post-meta">

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-12-02 11:25:48" itemprop="dateCreated datePublished" datetime="2021-12-02T11:25:48+08:00">2021-12-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2022-03-05 21:04:10" itemprop="dateModified" datetime="2022-03-05T21:04:10+08:00">2022-03-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/IOV安全/" itemprop="url" rel="index"><span itemprop="name">IOV安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>[toc]</p>
<h1 id="宝马汽车实验安全评估-总结报告"><a href="#宝马汽车实验安全评估-总结报告" class="headerlink" title="宝马汽车实验安全评估-总结报告"></a>宝马汽车实验安全评估-总结报告</h1><h1 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1. 介绍"></a>1. 介绍</h1><ul>
<li><p>近年来，越来越多的BMW汽车配备了新一代的“互联网连接”信息娱乐系统（如HU_NBT/HU_ENTRYNAV），也称为主机单元和远程通信控制单元（如TCB）。虽然这些组件明显提高了用户体验的便利性和性能，但它们也带来了新的被攻击机会。</p>
</li>
<li><p>在我们的工作中，我们系统地对多辆BMW汽车的Head Unit、TCU和中央网关模块的软硬件进行了深入和全面的分析。重点关注这些部件的外部攻击面后，我们发现，通过一组远程攻击面（包括GSM通信、BMW远程服务、BMW ConnectedDrive服务、UDS远程诊断、NGTP协议以及蓝牙协议），在广泛的区域内，对多辆连接互联网的BMW汽车进行远程的定点攻击是可行的。因此，对于攻击者而言，通过利用复杂攻击链（由不同汽车组件中的漏洞组成），可以很容易的获取对汽车CAN总线的远程控制。除此之外，即便车辆不可以联网，也可以通过物理访问方式（比如USB、以太网以及ODB-II接口）来威胁到Head Unit主机单元。我们根据测试可以确认，所有的漏洞将会影响到各种现代宝马车型。<a id="more"></a></p>
</li>
<li><p>我们的研究结果表，在选定BMW车辆模块的一定速度以上，可以获取到对信息娱乐系统、T-Box组件和UDS通信的本地和远程访问权限，并且能够通过任意代码执行、未经授权的车内系统诊断请求来获取到对CAN总线的远程控制。</p>
</li>
<li><p>本次报告总结了我们的研究结果，结构如下：</p>
<ul>
<li><p>章节2-4，描述了在技术受控级别（没有任何的可利用的技术细节）上的漏洞发现及攻击链</p>
</li>
<li><p>章节5，概述了受影响的宝马车型。</p>
</li>
<li><p>章节6，描述了披露过程。</p>
</li>
<li><p>章节6，对本次研究作出总结。</p>
</li>
</ul>
</li>
</ul>
<h1 id="2-研究描述"><a href="#2-研究描述" class="headerlink" title="2. 研究描述"></a>2. 研究描述</h1><ul>
<li><p>从安全角度来看，现代宝马汽车暴露了几个远程攻击面和一个物理攻击面。在本文中，我们重点关注了三个重要的车辆组件：信息娱乐系统（也称为Head Unit主机）、TCU（远程通信控制单元）和中央网关模块，它们容易受到外部攻击的影响。基于我们对宝马汽车车内网络的研究，我们发现这三个组件通过物理总线（如USB、CAN总线、以太网）与其他组件联系紧密。</p>
</li>
<li><p>图示：宝马车的内部网络</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081654.jpg" alt="image-20211219111024113"></p>
</li>
<li><p>在对固件进行深入的安全分析后，我们在这些车辆组件中发现14个漏洞。所有的软件漏洞可以通过在线重新配置和离线固件更新（而非OTA升级）来修复。</p>
</li>
<li><p>目前，宝马厂商正在制定漏洞修复计划，一些优先级较高的应对措施已开始实施。因此，我们决定在本文中进行一次简短的漏洞披露，而非对宝马用户不负责任的全面披露。完整的技术漏洞报告将在2019年的适当时间发布。</p>
</li>
</ul>
<h2 id="2-1-信息娱乐系统"><a href="#2-1-信息娱乐系统" class="headerlink" title="2.1 信息娱乐系统"></a>2.1 信息娱乐系统</h2><p><img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081705.jpg" alt="image-20211219112256232"></p>
<ul>
<li><p>BWM汽车的车载信息娱乐系统（也称NBT主机）由两部分组成：hu-intel系统和hu-jacinto系统。</p>
<ul>
<li><p><strong>hu-intel</strong>：运行在高层芯片（Intel x86）上的QNX系统，主要负责多媒体服务和BMW ConnectedDrive服务。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081703.jpg" alt="image-20211219112758700"></p>
</li>
<li><p><strong>hu-jacinto</strong>：运行在Jacinto ARM芯片（负责电源管理和CAN总线通信的底层芯片）上的QNX系统。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81655.jpg" alt="image-20211219112847610"></p>
</li>
</ul>
</li>
<li><p>hu-intel和hu-jacinto都可以通过QNET来互相通信。TCU通过USB连接到hu-intel，Head Unit主机与BMW远程服务器之间的通信数据将在此传输。hu-jacinto和TCU通过K-CAN总线（专门用于信息娱乐）连接。为了安全隔离，从hu-intel到中央网关模块的以太网连接被以太网交换机隔断，在较新的宝马汽车（如I3）中，中央网关模块和以太网交换机都集成到车身控制器模块（BDC/FEM）中。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81705.jpg" alt="image-20211219115345674"></p>
</li>
</ul>
<h3 id="2-1-1-USB接口"><a href="#2-1-1-USB接口" class="headerlink" title="2.1.1 USB接口"></a>2.1.1 USB接口</h3><ul>
<li><p>NBT在QNX OS中提供一些内置的io-pkt网络驱动程序，用于通过USB接口建立以太网网络。根据hu-intel中的USB配置文件，它默认支持某些USB-to-ETHERNET适配器。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081659.jpg" alt="image-20211219133912485"></p>
</li>
<li><p>通过网络驱动程序，当插入特定芯片组的USB dongle时，将启用USB-Ethernet网络。NBT主机将充当具有固定IP地址（192.168.0.1）的网络网关。更糟糕的是，这种USB Ethernet接口没有任何安全限制，因此导致可以获取到主机内部网络的访问权限，可以通过端口扫描检测到许多暴露的内部服务。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081704.jpg" alt="image-20211219134446954"></p>
</li>
<li><p>本地代码执行：有许多更新服务（比如导航及软件更新）运行在hu-intel系统之上，这些服务也用来监视U盘。当U盘中提供了预期的更新内容时，NBT将会进入一个特定的升级阶段。有些内容是被BMW私钥加密过的，有些则不然，这使得我们有机会以root权限控制hu-intel系统（在U盘中准备格式错误的内容，并利用更新服务中存在的漏洞）</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081657.jpg" alt="image-20211219135406898"></p>
</li>
<li><p>还有另外一种可以获取root shell的方法，晚一点会介绍。</p>
</li>
</ul>
<h3 id="2-1-2-OBD-II之上的E-NET"><a href="#2-1-2-OBD-II之上的E-NET" class="headerlink" title="2.1.2 OBD-II之上的E-NET"></a>2.1.2 OBD-II之上的E-NET</h3><ul>
<li><p>E-NET是一个车载以太网网络，位于宝马汽车的OBD-II接口上。汽车工程师可以通过E-NET连接到中央网关，对主机进行离线诊断和固件更新。在hu-intel系统中，也有相应的诊断服务， 负责处理来自中央网关的请求。对中央网关和NBT之间的诊断协议进行逆向后，我们发现了可用于绕过代码签名机制的漏洞，并成功地从hu-intel系统获得了root-shell。</p>
</li>
<li><p>此外，考虑一种低成本的方式：通过使用USB-Ethernet dongle，黑客也可以获取更高层次的QNX系统的root权限。此系统位于en5接口，且拥有固定ip地址(192.168.0.1)。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081658.jpg" alt="image-20211219142927502"></p>
</li>
</ul>
<h3 id="2-1-3-蓝牙协议栈"><a href="#2-1-3-蓝牙协议栈" class="headerlink" title="2.1.3 蓝牙协议栈"></a>2.1.3 蓝牙协议栈</h3><ul>
<li><p>通过内置的蓝牙功能，NBT允许手机连接到它进行免提通话。即然我们已经获取到了hu-intel系统的root权限，因此我们确定了负责处理蓝牙功能的特定服务。通过逆向工程，我们发现它使用了第三方蓝牙协议栈库，其是蓝牙协议栈管理和服务组件的实现。在fuzz蓝牙协议栈之后，最终得到一个可以导致内存崩溃的畸形数据包。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81658.jpg" alt="image-20211219143335508"></p>
</li>
<li><p>因此，将NBT设置为配对模式，可以在没有PIN码的情况下，利用该漏洞使hu-intel系统中的蓝牙协议栈崩溃。由于内部watchdog机制的存在，因此主机会重新启动。</p>
</li>
</ul>
<h3 id="2-1-4-ConnectedDrive服务"><a href="#2-1-4-ConnectedDrive服务" class="headerlink" title="2.1.4 ConnectedDrive服务"></a>2.1.4 ConnectedDrive服务</h3><p><img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081701.jpg" alt="image-20211219145059185"></p>
<ul>
<li><p>NBT中的BMW ConnectedDrive服务通过内置在TCU中的嵌入式SIM卡来实现蜂窝网络连接，为客户提供广泛的在线功能，包括ConnectedDrive商店、远程服务、实时交通信息（RTTI）、智能紧急呼叫、在线天气和在线新闻。ConnectedDrive服务提供的大多数在线功能都是由车载浏览器处理的，在NBT中被称为“DevCtrlBrowser_Bon”（使用定制的浏览器引擎，似乎是由Harman 为车载信息娱乐系统开发的）。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081700.jpg" alt="image-20211219145518431"></p>
</li>
<li><p>远程代码执行：使用USRP（universal software radio peripheral）和OpenBTS实现了稳定的GSM网络后，所有来自ConnectedDrive服务的流量都将被捕获，并且由于ConnectedDrive服务的一些不安全实现，我们还成功拦截了来自ConnectedDrive服务的网络流量。在那之后，我们可以很轻松的在在“DevCtrlBrowser_Bon”中发现bug。之后，我们利用其一个内存破坏漏洞，在主机中实现了浏览器权限的远程代码执行。最后，结合之前的漏洞利用，实现了root提权，并获取了NBT的远程root shell（不同于2.1.1章节的方法）</p>
</li>
</ul>
<h3 id="2-1-5-K-CAN总线"><a href="#2-1-5-K-CAN总线" class="headerlink" title="2.1.5 K-CAN总线"></a>2.1.5 K-CAN总线</h3><ul>
<li>在利用上述漏洞，获取到高层QNX系统（hu-intel）的访问权限后，还可以通过QNET登录到底层的hu-Jacino。如上所述，hu-jacinto运行在Jacinto ARM芯片上，负责处理CAN消息。通过深入分析，我们找到了在K-CAN总线上发送任意CAN消息的两种方法：<ol>
<li>尽管datasheet不对外开放，但可以重用CAN总线驱动程序（TI开发的BSP项目）中的一些源代码，操控Jacinto芯片的特定内存来发送CAN消息。</li>
<li>通过动态hook 驱动程序中CAN消息传输的函数，可以稳定地向K-CAN总线发送任意CAN消息。</li>
</ol>
</li>
<li>结合这些漏洞，可以远程破坏NBT。之后，可以利用中央网关模块中一些特殊的远程诊断接口，来发送任意诊断消息（UDS），控制不同CAN总线上的ECU。</li>
</ul>
<h2 id="2-2-远程通信控制单元TCU"><a href="#2-2-远程通信控制单元TCU" class="headerlink" title="2.2 远程通信控制单元TCU"></a>2.2 远程通信控制单元TCU</h2><ul>
<li><p>TCU通过蜂窝网络为车辆提供电话功能、远程通信服务（如E-Call、B-Call等）以及远程服务（如远程解锁、温度控制等）。在本节中，我们的目标是德国“Peiker Acustic GmbH”生产的远程通信箱（TCB）控制单元，它是现代宝马汽车中使用的最广泛TCU，配备了NBT和ENTRYNAV头部单元。</p>
</li>
<li><p>硬件架构：TCB控制单元可以分成两部分，高层部分是MPU（基于带有AMSS RTOS的高通MDM6200基带处理器），借助嵌入SIM卡，MDM6200负责TCB和BMW远程服务器之间的远程通信。低层部分是MCU（基于飞思卡尔9S12X的CAN控制器），通过K-CAN总线直接连接到中央网关模块。MPU使用基于UART的IPC机制与MCU通信。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-081702.jpg" alt="image-20211219155801751"></p>
</li>
<li><p>软件架构：TCB控制单元是BMW ConnectedDrive系统功能的平台之一，TCB可以建立到GSM和UMTS的网络连接，在我们对固件的逆向过程中，发现TCB支持以下功能：</p>
<ol>
<li>增强的紧急呼叫</li>
<li>BWM的远程服务（比如远程车门开锁等）</li>
<li>BMW TeleService诊断，包括TeleService帮助</li>
<li>BMW TeleService Call</li>
<li>BMW LastStateCall</li>
<li>其它</li>
</ol>
</li>
<li><p>REX OS（实时执行操作系统）在TCB的MPU上运行，其是高通公司为基于ARM的高级模式用户软件(AMSS)开发的操作系统，有60多个系统任务（“CallManager”, “Diag_task”, “Voice”, “GPRS LLC”等），以及大约34个应用程序任务（“NGTPD”, “NAD Diag”, “SMSClient”, “LastStateCall”等）。</p>
<p>  <img src="https://note-1252764528.cos.ap-chengdu.myqcloud.com/2021-12-19-81701.jpg" alt="image-20211219161620673"></p>
</li>
</ul>
<h3 id="2-2-1-Remote-Service-with-NGTP"><a href="#2-2-1-Remote-Service-with-NGTP" class="headerlink" title="2.2.1 Remote Service with NGTP"></a>2.2.1 Remote Service with NGTP</h3><p>未完待续…</p>
<blockquote>
<p>原文链接：</p>
<p>腾讯科恩实验室最新汽车安全研究成果:宝马多款车型的安全研究综述：<a href="https://keenlab.tencent.com/zh/2018/05/22/New-CarHacking-Research-by-KeenLab-Experimental-Security-Assessment-of-BMW-Cars/" target="_blank" rel="noopener">https://keenlab.tencent.com/zh/2018/05/22/New-CarHacking-Research-by-KeenLab-Experimental-Security-Assessment-of-BMW-Cars/</a></p>
<p><a href="https://keenlab.tencent.com/en/whitepapers/Experimental_Security_Assessment_of_BMW_Cars_by_KeenLab.pdf" target="_blank" rel="noopener">https://keenlab.tencent.com/en/whitepapers/Experimental_Security_Assessment_of_BMW_Cars_by_KeenLab.pdf</a></p>
</blockquote>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>21Guns
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://21guns.top/2021/12/02/iov/宝马汽车实验安全评估-总结报告/" title="宝马汽车实验安全评估-总结报告">http://21guns.top/2021/12/02/iov/宝马汽车实验安全评估-总结报告/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/IOV安全/" rel="tag"># IOV安全</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2021/11/28/iov/车机分析及固件提取/" rel="prev" title="车机分析及固件提取">
      <i class="fa fa-chevron-left"></i> 车机分析及固件提取
    </a></div>
      <div class="post-nav-item">
    <a href="/2021/12/13/iov/汽车安全的攻击面/" rel="next" title="汽车安全的攻击面">
      汽车安全的攻击面 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#宝马汽车实验安全评估-总结报告"><span class="nav-number">1.</span> <span class="nav-text">宝马汽车实验安全评估-总结报告</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#1-介绍"><span class="nav-number">2.</span> <span class="nav-text">1. 介绍</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#2-研究描述"><span class="nav-number">3.</span> <span class="nav-text">2. 研究描述</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-信息娱乐系统"><span class="nav-number">3.1.</span> <span class="nav-text">2.1 信息娱乐系统</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-1-USB接口"><span class="nav-number">3.1.1.</span> <span class="nav-text">2.1.1 USB接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-2-OBD-II之上的E-NET"><span class="nav-number">3.1.2.</span> <span class="nav-text">2.1.2 OBD-II之上的E-NET</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-3-蓝牙协议栈"><span class="nav-number">3.1.3.</span> <span class="nav-text">2.1.3 蓝牙协议栈</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-4-ConnectedDrive服务"><span class="nav-number">3.1.4.</span> <span class="nav-text">2.1.4 ConnectedDrive服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-5-K-CAN总线"><span class="nav-number">3.1.5.</span> <span class="nav-text">2.1.5 K-CAN总线</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-远程通信控制单元TCU"><span class="nav-number">3.2.</span> <span class="nav-text">2.2 远程通信控制单元TCU</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-1-Remote-Service-with-NGTP"><span class="nav-number">3.2.1.</span> <span class="nav-text">2.2.1 Remote Service with NGTP</span></a></li></ol></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="21Guns" src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">21Guns</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">164</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">71</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="vx:lxllxllx1" title="Wechat → vx:lxllxllx1" rel="noopener" target="_blank"><i class="fab fa-weixin fa-fw"></i>Wechat</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://github.com/21Gun5" title="GitHub → https://github.com/21Gun5" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2016 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">21Guns</span>
</div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.5" zindex="0" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  




  <script src="/js/local-search.js"></script>












  

  

</body>
</html>
